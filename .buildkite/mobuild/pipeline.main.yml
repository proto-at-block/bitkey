notify:
  - slack: "#bitkey-mobile-robots"
    if: build.state == "failed"

steps:
  - label: "Main branch debug build"
    retry:
      automatic:
        - exit_status: -1  # Agent was lost
          limit: 2
        - exit_status: 255 # Forced agent shutdown
          limit: 2
    agents:
      xcode: 26.2.0
    env:
      SKIP_BUILDKITE_AGENT_CHECKOUT: "true"
    plugins:
      - squareup/ios-builder#v1.1.3:
          build_action: debug
  - label: "Main branch unit test"
    retry:
      automatic:
        - exit_status: -1  # Agent was lost
          limit: 2
        - exit_status: 255 # Forced agent shutdown
          limit: 2
    agents:
      xcode: 26.2.0
    env:
      SKIP_BUILDKITE_AGENT_CHECKOUT: "true"
    plugins:
      - squareup/ios-builder#v1.1.3:
          build_action: unit
